<!DOCTYPE html>
<html lang="en" data-bs-theme="auto">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="icon" href="/ui/img/favicon.ico">
        <title>IncusOS image downloader</title>

        <!-- Bootstrap core CSS -->
        <link href="/ui/css/bootstrap.min.css" rel="stylesheet">
        <link href="/ui/css/local.css" rel="stylesheet">
    </head>

    <body>
        <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
            <symbol id="exclamation-triangle-fill" fill="currentColor" viewBox="0 0 16 16">
                <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
            </symbol>
        </svg>
        <div class="container w-75">
            <script src="/ui/js/bootstrap.min.js"></script>
            <script src="/ui/js/local.js"></script>

            <h1>IncusOS image downloader</h1>

            <div class="card">
                <h5 class="card-header">Introduction</h5>
                <div class="card-body">
                    <p class="card-text w-75">
                        IncusOS is designed to provide an extremely secure
                        environment in which to run Incus and related software.<br>

                        It requires a lot of modern system features and
                        will not function properly on older unsupported systems.
                    </p>

                    <ul>
                        <li>Modern x86_64 or arm64 system (5 years old at most)</li>
                        <li>Support for UEFI with SecureBoot</li>
                        <li>TPM 2.0 security module</li>
                        <li>At least 50GiB of storage</li>
                        <li>At least one wired network port</li>
                    </ul>

                    <a class="btn btn-primary" href="https://linuxcontainers.org/incus-os/" role="button" target="_blank">Website</a>
                    <a class="btn btn-primary" href="https://linuxcontainers.org/incus-os/docs/main/" role="button" target="_blank">Documentation</a>
                    <a class="btn btn-primary" href="https://discuss.linuxcontainers.org/" role="button" target="_blank">Community</a>
                </div>
            </div>

            <div class="accordion">
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#panelSelection" aria-expanded="true" aria-controls="panelSelection">
                            Image selection
                        </button>
                    </h2>

                    <div id="panelSelection" class="accordion-collapse collapse show">
                        <div class="accordion-body">
                            <p class="card-text w-75">
                                IncusOS doesn't feature a traditional installer.
                                Instead you can choose to either directly run it
                                from the media it's written to, or have it
                                automatically install itself onto an internal
                                drive on first boot.
                            </p>

                            <p class="card-text w-75">
                                The installed system is only reachable through
                                the API, there is no local shell access or remote
                                access through SSH.

                                The customization tool below allows you to
                                configure IncusOS' behavior, including what
                                client will be allowed to control the system.
                            </p>

                            <div>
                                <h3>Image type</h3>
                                <div class="mb-3">
                                    <input class="form-check-input" type="radio" name="imageType" id="imageTypeISO" checked>
                                    <label class="form-check-label" for="imageTypeISO">ISO - Read-only, primarily used for server installation through virtual media)</label>
                                </div>

                                <div class="mb-3">
                                    <input class="form-check-input" type="radio" name="imageType" id="imageTypeUSB">
                                    <label class="form-check-label" for="imageTypeUSB">USB - Writable and can be used either for installation or for running the system directly</label>
                                </div>
                            </div>

                            <div>
                                <h3>Image usage</h3>
                                <div class="mb-3">
                                    <input class="form-check-input" type="radio" name="imageUsage" id="imageUsageInstallation" checked>
                                    <label class="form-check-label" for="imageUsageInstallation">Installation - Install IncusOS on a boot disk</label>
                                </div>

                                <div class="mb-3">
                                    <input class="form-check-input" type="radio" name="imageUsage" id="imageUsageOperation">
                                    <label class="form-check-label" for="imageUsageOperation">Operation - Run IncusOS directly from the media</label>
                                </div>
                            </div>

                            <div>
                                <h3>Image architecture</h3>
                                <div class="mb-3">
                                    <input class="form-check-input" type="radio" name="imageArchitecture" id="imageArchitectureX86_64" checked>
                                    <label class="form-check-label" for="imageArchitectureX86_64">x86_64 - For 64-bit Intel and AMD systems</label>
                                </div>

                                <div class="mb-3">
                                    <input class="form-check-input" type="radio" name="imageArchitecture" id="imageArchitectureAARCH64">
                                    <label class="form-check-label" for="imageArchitectureAARCH64">aarch64 - For 64-bit Arm servers</label>
                                </div>
                            </div>

                            <div>
                                <h3>Image application</h3>
                                <div class="mb-3">
                                    <input class="form-check-input" type="radio" name="imageApplication" id="imageApplicationIncus" checked>
                                    <label class="form-check-label" for="imageApplicationIncus">Incus - Container and VM private cloud platform</label>
                                </div>

                                <div class="mb-3">
                                    <input class="form-check-input" type="radio" name="imageApplication" id="imageApplicationOperationsCenter">
                                    <label class="form-check-label" for="imageApplicationOperationsCenter">Operations Center - Central deployment and tracking of Incus clusters <span class="badge bg-secondary">Beta</span></label>
                                </div>

                                <div class="mb-3">
                                    <input class="form-check-input" type="radio" name="imageApplication" id="imageApplicationMigrationManager">
                                    <label class="form-check-label" for="imageApplicationMigrationManager">Migration Manager - VMware to Incus migration orchestrator <span class="badge bg-secondary">Beta</span></label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#panelTarget" aria-expanded="true" aria-controls="panelTarget">
                            Installation target
                        </button>
                    </h2>

                    <div id="panelTarget" class="accordion-collapse collapse show">
                        <div class="accordion-body">
                            <div class="mb-3">
                                <input class="form-check-input" type="checkbox" value="" id="imageForceInstall">
                                <label class="form-check-label" for="imageForceInstall">Wipe the target drive</label>
                            </div>

                            <div class="mb-3">
                                <input class="form-check-input" type="checkbox" value="" id="imageForceReboot">
                                <label class="form-check-label" for="imageForceReboot">Automatically reboot after installation</label>
                            </div>

                            <div class="mb-3">
                                <label class="form-label" for="imageInstallTarget">
                                    <b>Target drive identifier</b>
                                    <br>
                                    This is a (potentially partial) value (as seen in /dev/disk/by-id). The value must match exactly one drive.
                                    <br>
                                    If empty, IncusOS will auto-install so long as only one drive is present.
                                </label>
                                <input type="text" class="form-control" id="imageInstallTarget" placeholder="nvme-eui.123456789">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#panelApplication" aria-expanded="true" aria-controls="panelApplication">
                            Application configuration
                        </button>
                    </h2>

                    <div id="panelApplication" class="accordion-collapse collapse show">
                        <div class="accordion-body">
                            <div class="mb-3">
                                <input class="form-check-input" type="checkbox" value="" id="applicationDefaults" checked>
                                <label class="form-check-label" for="applicationDefaults">Apply default configuration</label>
                            </div>

                            <div class="mb-3">
                                <label class="form-label" for="applicationClientCertificate">
                                    <b>TLS client certificate of the initial trusted client.</b>
                                    <br>
                                    If using the <a href="https://github.com/lxc/incus/releases/latest/" target="_blank">Incus CLI tool</a>, this can be retrieved by running <code>incus remote get-client-certificate</code>.
                                    <br>
                                    Alternatively, one can be <a onclick="certificate()" href="#certificate">generated</a> for you which can be imported in your web browser for UI access.
                                </label>
                                <textarea class="form-control" id="applicationClientCertificate" rows="10" placeholder="-----BEGIN CERTIFICATE-----&#10;<snip>&#10;-----END CERTIFICATE-----"></textarea>

                            </div>
                        </div>
                    </div>
                </div>

                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelAdvanced" aria-expanded="false" aria-controls="panelAdvanced">
                            Advanced settings
                        </button>
                    </h2>

                    <div id="panelAdvanced" class="accordion-collapse collapse">
                        <div class="accordion-body">
                            <div class="mb-3">
                                <h3>Network configuration</h3>

                                <p>
                                    By default IncusOS will run both DHCPv4
                                    and SLAAC on every interface it can find
                                    on the system, hoping that one of them
                                    will provide enough connectivity to
                                    allow the user to connect and apply the
                                    final network configuration.
                                </p>

                                <p>
                                    For cases where this approach doesn't
                                    work, such as environments requiring
                                    static IP addresses, the use of a
                                    proxy server or using link aggregation
                                    or VLANs, a full network configuration
                                    can be provided instead.
                                </p>

                                <p>
                                    Supported options and examples can be <a href="https://linuxcontainers.org/incus-os/docs/main/reference/system/network/" target="_blank">found here</a>.
                                </p>

                                <textarea class="form-control" id="networkConfiguration" rows="12" placeholder='{&#10;  "interfaces": [&#10;    {&#10;      "name": "management",&#10;      "hwaddr": "00:11:22:33:44:55",&#10;      "addresses": [&#10;        "dhcp4",&#10;        "slaac"&#10;      ]&#10;    }&#10;  ]&#10;}'></textarea>
                            </div>

                            <div class="mb-3">
                                <h3>Alternative image channel</h3>

                                <p>
                                    Images are normally downloaded from
                                    the "stable" update channel.<br>Other
                                    channels may be available for various
                                    reasons, for example for image
                                    validation and testing ("testing" channel).
                                </p>

                                <p>
                                    Only the "stable" channel is
                                    supported, use other image channels
                                    at your own risk.
                                </p>

                                <input type="text" class="form-control" id="imageChannel" placeholder="stable">
                            </div>

                            <div class="mb-3">
                                <h3>Boot security</h3>

                                <p>
                                    IncusOS relies on both UEFI Secure
                                    Boot and a TPM 2.0 module to provide
                                    strong boot security.<br>
                                    Unfortunately some systems don't
                                    fully support those features. To
                                    handle that, IncusOS can be installed
                                    with degraded boot security.
                                </p>

                                <div class="mb-3">
                                    <input class="form-check-input" type="radio" name="installSecurity" id="installSecurityOptimal" checked>
                                    <label class="form-check-label" for="installSecurityOptimal">Optimal boot security (UEFI Secure Boot & TPM 2.0)</label>
                                </div>

                                <div class="mb-3">
                                    <input class="form-check-input" type="radio" name="installSecurity" id="installSecurityNoTPM">
                                    <label class="form-check-label" for="installSecurityNoTPM">Degraded boot security (no TPM 2.0 module)</label>
                                </div>

                                <div class="mb-3">
                                    <input class="form-check-input" type="radio" name="installSecurity" id="installSecurityNoSecureBoot">
                                    <label class="form-check-label" for="installSecurityNoSecureBoot">Degraded boot security (no Secure Boot)</label>
                                </div>

                                <div class="alert alert-danger d-flex align-items-center" role="alert">
                                    <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Danger:"><use xlink:href="#exclamation-triangle-fill"/></svg>
                                    <div>
                                        Installing with degraded boot
                                        security should be avoided as
                                        much as possible.<br>The resulting
                                        installation will be marked as
                                        having degraded security which may
                                        restrict some functionality and
                                        the ability to get support on it.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div>
                <button onclick="download()" type="submit" class="btn btn-primary">Download</button>
            </div>
        </div>

        <div class="modal modal-xl fade" id="certificateModal" tabindex="-1" role="dialog" aria-labelledby="certificateModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="certificateModalLabel">Certificate generated</h5>
                    </div>

                    <div class="modal-body">
                        <p>
                            Three files have been generated and downloaded for you:
                        </p>
                        <ul>
                           <li><code>client.crt</code> is a PEM encoded client certificate (can be placed as <code>~/.config/incus/client.crt</code>)</li>
                           <li><code>client.key</code> is a PEM encoded client key (can be placed as <code>~/.config/incus/client.key</code>)</li>
                           <li><code>client.pfx</code> is a PPKCS#12 certificate that can be imported in your web browser (password is <b>IncusOS</b>)</li>
                        </ul>
                        <br>
                        <p>
                            <b>NOTE:</b> This certificate was generated server-side.
                            <br>
                            While we don't keep any record of it, it is generally preferrable to manually generate your certificate locally to avoid any chance of it getting intercepted.
                        </p>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
